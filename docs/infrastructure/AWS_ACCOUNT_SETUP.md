# 新しいAWSアカウントのセットアップガイド

## 📋 このガイドの目的

新しいAWSアカウントを作成し、デプロイに必要な設定を完了するための手順です。

## 🎯 セットアップ手順

### 1. AWSアカウントの作成

#### 1.1 アカウント作成

1. [AWS公式サイト](https://aws.amazon.com/jp/)にアクセス
2. **「アカウントを作成」**または**「今すぐ無料でサインアップ」**をクリック
3. 以下の情報を入力：
   - メールアドレス
   - パスワード（強力なパスワードを推奨）
   - アカウント名（任意）
4. **「アカウントと続行」**をクリック

#### 1.2 連絡先情報の入力

1. 連絡先情報を入力：
   - 会社名（個人の場合は個人名）
   - 電話番号
   - 国/地域
   - 住所
2. **「アカウントを作成して続行」**をクリック

#### 1.3 電話番号認証

1. 電話番号を入力
2. **「今すぐ電話する」**または**「今すぐSMSを送信」**を選択
3. 受信したPINコードを入力
4. **「PINを確認」**をクリック

#### 1.4 サポートプランの選択

1. **「基本サポート - 無料」**を選択（推奨）
2. **「サインアップを完了」**をクリック

#### 1.5 クレジットカード情報の入力

1. クレジットカード情報を入力
   - **重要:** 無料利用枠内なら課金されませんが、超過すると課金されます
   - 請求アラートを必ず設定してください（次のステップ）
2. **「セキュアな送信」**をクリック

**✅ 確認:** AWSコンソールにログインできること

---

### 2. 請求アラートの設定（必須）

予算超過を防ぐため、**必ず設定してください**。

#### 2.1 予算の作成

1. AWSコンソールにログイン
2. 右上のアカウント名をクリック → **「請求ダッシュボード」**
3. 左メニューから **「予算」** を選択
4. **「予算を作成」** をクリック

#### 2.2 予算の設定

1. **「コスト予算」** を選択 → **「次へ」**
2. **「予算の設定」**:
   - 予算名: `Monthly Budget`
   - 予算額: `$60`（または希望の金額）
   - 期間: `毎月繰り返し`
3. **「次へ」** をクリック

#### 2.3 アラートの設定

1. **「アラートの設定」**:
   - **「実際のコスト」** を選択
   - しきい値: `80%` → メールアドレスを入力
   - しきい値: `100%` → 同じメールアドレスを入力
2. **「次へ」** → **「予算を作成」** をクリック

**✅ 確認:** 予算が作成され、メール通知が設定されていること

---

### 3. IAMユーザーの作成（推奨）

ルートアカウント（作成したアカウント）で作業するのではなく、IAMユーザーを作成して作業することを強く推奨します。

#### 3.1 ユーザーの作成

1. AWSコンソール → **IAM** を検索
2. 左メニューから **「ユーザー」** を選択
3. **「ユーザーを追加」** をクリック

#### 3.2 ユーザー情報の入力

1. **「ユーザー名」**: `attendance-deploy-user`（任意の名前）
2. **「AWS認証情報タイプ」**:
   - ✅ **「プログラムによるアクセス」** にチェック
   - ✅ **「AWS Management Console へのアクセス」** は任意（チェックしなくてもOK）
3. **「次のステップ: アクセス権限」** をクリック

#### 3.3 アクセス権限の設定

1. **「既存のポリシーを直接アタッチ」** を選択
2. 以下のポリシーにチェックを入れる：
   - `AmazonEC2ContainerRegistryFullAccess` (ECR用)
   - `AmazonECS_FullAccess` (ECS用)
   - `AmazonS3FullAccess` (S3用)
   - `AmazonRDSFullAccess` (RDS用)
   - `AmazonElastiCacheFullAccess` (ElastiCache用)
   - `SecretsManagerReadWrite` (Secrets Manager用)
   - `CloudWatchFullAccess` (CloudWatch用)
   - `CloudFrontFullAccess` (CloudFront用)
   - `ElasticLoadBalancingFullAccess` (ALB用)
3. **「次のステップ: タグ」** をクリック（タグは任意）
4. **「次のステップ: 確認」** をクリック
5. 内容を確認して **「ユーザーの作成」** をクリック

#### 3.4 アクセスキーの保存（重要！）

1. **「.csvのダウンロード」** をクリックして、CSVファイルを保存
   - または、画面に表示されている情報をメモ
2. **「アクセスキーID」** と **「シークレットアクセスキー」** を必ず記録
   - ⚠️ **この画面を閉じると、シークレットキーは二度と表示されません**
3. **「完了」** をクリック

**✅ 確認:** アクセスキーIDとシークレットアクセスキーを安全に保管していること

---

### 4. MFA（多要素認証）の設定（推奨）

セキュリティ強化のため、MFAを有効化することを推奨します。

#### 4.1 MFAデバイスの割り当て

1. IAM → **「ユーザー」** → 作成したユーザーを選択
2. **「セキュリティ認証情報」** タブ
3. **「MFAデバイスの割り当て」** をクリック

#### 4.2 認証アプリの設定

1. **「仮想MFAデバイス」** を選択 → **「次へ」**
2. スマートフォンに認証アプリをインストール（まだの場合）:
   - Google Authenticator
   - Microsoft Authenticator
   - Authy
3. 認証アプリでQRコードをスキャン
4. 2つの連続する認証コードを入力
5. **「MFAデバイスの割り当て」** をクリック

**✅ 確認:** MFAが有効になっていること

---

### 5. AWS CLIの設定

#### 5.1 AWS CLIのインストール

**macOS:**
```bash
brew install awscli
```

**Linux (WSL):**
```bash
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install
```

**Windows:**
[公式インストーラー](https://awscli.amazonaws.com/AWSCLIV2.msi)をダウンロードして実行

#### 5.2 認証情報の設定

```bash
aws configure
```

以下を入力：
- **AWS Access Key ID**: [Step 3.4で保存したアクセスキーID]
- **AWS Secret Access Key**: [Step 3.4で保存したシークレットアクセスキー]
- **Default region name**: `ap-northeast-1`
- **Default output format**: `json`

#### 5.3 動作確認

```bash
aws sts get-caller-identity
```

アカウント情報が表示されればOKです。

**✅ 確認:** AWS CLIが正しく設定されていること

---

## 📋 チェックリスト

セットアップが完了したら、以下を確認：

- [ ] AWSアカウントにログインできる
- [ ] 請求アラートが設定されている
- [ ] IAMユーザーが作成されている
- [ ] アクセスキーIDとシークレットアクセスキーを保存している
- [ ] MFAが設定されている（推奨）
- [ ] AWS CLIがインストール・設定されている
- [ ] `aws sts get-caller-identity` でアカウント情報が表示される

---

## 🚀 次のステップ

セットアップが完了したら、[GET_STARTED.md](./GET_STARTED.md) の **Step 2** から始めてください。

---

## ⚠️ 重要な注意事項

### 無料利用枠について

新しいAWSアカウントには12ヶ月間の無料利用枠がありますが、**すべてのサービスが対象ではありません**：

**無料利用枠の対象:**
- EC2: 750時間/月（t2.micro）
- S3: 5GBストレージ
- RDS: 750時間/月（db.t2.micro）
- データ転送: 15GB/月

**無料利用枠の対象外（このプロジェクトで使用）:**
- ECS Fargate（約$7.50/月）
- Application Load Balancer（約$16.20/月）
- ElastiCache（約$12/月）

**合計: 約$35-40/月**（無料利用枠を除く）

### 請求アラートの重要性

- 無料利用枠を超えると自動的に課金されます
- 予期しない請求を防ぐため、**必ず請求アラートを設定してください**
- 80%と100%の2段階でアラートを設定することを推奨

### セキュリティのベストプラクティス

1. **ルートアカウントは使用しない**: IAMユーザーで作業
2. **MFAを有効化**: セキュリティ強化
3. **最小権限の原則**: 必要な権限のみ付与
4. **アクセスキーを安全に保管**: 漏洩しないよう注意

---

## 🆘 トラブルシューティング

### AWS CLIが動作しない

```bash
# バージョンを確認
aws --version

# 認証情報を再設定
aws configure

# 認証情報を確認
aws sts get-caller-identity
```

### アクセスキーを紛失した場合

1. IAM → ユーザー → セキュリティ認証情報
2. 古いアクセスキーを削除
3. 新しいアクセスキーを作成

### 請求アラートが届かない

1. 予算の設定を確認
2. メールアドレスが正しいか確認
3. スパムフォルダを確認

---

**🎉 セットアップ完了！**

[GET_STARTED.md](./GET_STARTED.md) に戻って、次のステップに進んでください。

